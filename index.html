<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
<!-- Tesseract.js (Neural) -->
<script src="https://unpkg.com/tesseract.js@5.0.5/dist/tesseract.min.js"></script>
<!-- PDF.js (per PDF multipagina) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs" type="module"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.mjs" type="module"></script>
<!-- OpenCV.js (preprocessing immagini) -->
<script async src="https://docs.opencv.org/4.8.0/opencv.js"></script>

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
        --success-color: #059669;
        --error-color: #dc2626;
        --warning-color: #f59e0b;
        --info-color: #3b82f6;
        --dark-bg: #1e293b;
        --light-bg: #f8fafc;
        --card-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        --radius: 16px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'SF Pro Display','Segoe UI',sans-serif; background:var(--light-bg); color:var(--dark-bg); line-height:1.6; }

    /* Auth */
    .auth-container { min-height:100vh; display:flex; align-items:center; justify-content:center; background:var(--primary-gradient); padding:2rem; }
    .auth-card { background:rgba(255,255,255,0.95); backdrop-filter:blur(20px); border-radius:var(--radius); padding:3rem; box-shadow:var(--card-shadow); width:100%; max-width:480px; text-align:center; border:1px solid rgba(255,255,255,0.2); }
    .auth-logo { width:90px; height:90px; margin:0 auto 1.5rem; background:var(--secondary-gradient); border-radius:14px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:2rem; }
    .auth-title { font-size:2.2rem; font-weight:800; color:var(--dark-bg); }
    .auth-subtitle { color:#64748b; margin:0.75rem 0 2rem; }
    .form-group { margin-bottom:1.25rem; text-align:left; }
    .form-label { font-weight:700; margin-bottom:0.5rem; display:block; font-size:0.9rem; }
    .form-input, .form-select { width:100%; padding:0.9rem 1rem; border:2px solid #e2e8f0; border-radius:12px; background:#fff; font-size:1rem; transition:0.2s; }
    .form-input:focus, .form-select:focus { outline:none; border-color:var(--info-color); box-shadow:0 0 0 3px rgba(59,130,246,0.15); }
    .btn { width:100%; background:var(--secondary-gradient); color:#fff; padding:0.9rem 1rem; border:none; border-radius:12px; font-weight:700; cursor:pointer; transition:0.2s; margin-bottom:0.75rem; }
    .btn:hover { transform:translateY(-1px); box-shadow:0 10px 20px rgba(0,0,0,0.12); }
    .btn-register { background:linear-gradient(135deg, var(--success-color), #047857); }
    .auth-message { display:none; margin-top:0.75rem; padding:0.75rem 1rem; border-radius:10px; font-weight:600; }
    .auth-message.success { background:rgba(5,150,105,0.1); border:1px solid var(--success-color); color:var(--success-color); }
    .auth-message.error { background:rgba(220,38,38,0.1); border:1px solid var(--error-color); color:var(--error-color); }
    .auth-message.info { background:rgba(59,130,246,0.1); border:1px solid var(--info-color); color:var(--info-color); }

    /* Header */
    .app-container { display:none; }
    .header { background:var(--secondary-gradient); color:#fff; padding:1rem 0; position:sticky; top:0; z-index:100; box-shadow:0 8px 24px rgba(0,0,0,0.08); }
    .header-container { max-width:1280px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:0 1rem; }
    .logo { display:flex; align-items:center; gap:0.75rem; font-weight:800; }
    .logo-icon { width:42px; height:42px; background:rgba(255,255,255,0.2); border-radius:10px; display:flex; align-items:center; justify-content:center; }
    .nav { display:flex; gap:0.5rem; flex-wrap:wrap; }
    .nav-btn { background:rgba(255,255,255,0.12); color:#fff; border:none; padding:0.6rem 0.9rem; border-radius:10px; cursor:pointer; font-weight:600; }
    .nav-btn.active, .nav-btn:hover { background:rgba(255,255,255,0.22); }
    .btn-logout { background:rgba(239,68,68,0.2); border:1px solid rgba(239,68,68,0.35); color:#fff; padding:0.4rem 0.75rem; border-radius:8px; cursor:pointer; }

    /* Main */
    .main { max-width:1280px; margin:0 auto; padding:1.25rem; }
    .section { display:none; }
    .section.active { display:block; }
    .section-header { text-align:center; margin:1.25rem 0 1.5rem; }
    .section-title { font-size:2rem; font-weight:900; }
    .section-subtitle { color:#64748b; }

    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin:1rem 0 1.25rem; }
    .stat-card { background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:1.25rem; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.05); }
    .stat-icon { width:56px; height:56px; margin:0 auto 0.5rem; border-radius:12px; display:flex; align-items:center; justify-content:center; color:#fff; }
    .stat-card:nth-child(1) .stat-icon { background:#3b82f6; }
    .stat-card:nth-child(2) .stat-icon { background:#059669; }
    .stat-card:nth-child(3) .stat-icon { background:#f59e0b; }
    .stat-card:nth-child(4) .stat-icon { background:#dc2626; }
    .stat-value { font-size:1.7rem; font-weight:900; }
    .stat-label { color:#64748b; font-size:0.8rem; text-transform:uppercase; }

    .card { background:#fff; border:1px solid #e2e8f0; border-radius:14px; padding:1.25rem; box-shadow:0 6px 16px rgba(0,0,0,0.06); margin-bottom:1rem; }

    /* Upload AI OCR */
    .upload-area { border:2px dashed #cbd5e1; border-radius:14px; padding:2rem; text-align:center; background:#fff; cursor:pointer; transition:0.2s; }
    .upload-area:hover, .upload-area.dragover { border-color:#3b82f6; background:#f8fbff; }
    .upload-icon { font-size:3rem; color:#94a3b8; margin-bottom:0.5rem; }
    .upload-title { font-weight:800; }
    .upload-subtitle { color:#64748b; font-size:0.95rem; }

    .ocr-preview { max-width:100%; max-height:320px; border:2px solid #e2e8f0; border-radius:12px; margin:1rem 0; }
    .ai-ocr-container { display:none; }
    .ai-ocr-container.show { display:block; }
    .ai-status-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:0.75rem; margin:1rem 0; }
    .ai-status-card { background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; padding:1rem; }
    .ai-progress-bar { width:100%; height:10px; background:#e2e8f0; border-radius:6px; overflow:hidden; }
    .ai-progress-fill { height:100%; width:0%; background:var(--secondary-gradient); transition:width 0.3s; }

    .extracted-text-container { display:none; background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; padding:1rem; margin:1rem 0; }
    .extracted-text-container.show { display:block; }
    .extracted-text { white-space:pre-wrap; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:0.9rem; background:#fff; border:1px solid #e2e8f0; border-radius:8px; padding:1rem; max-height:280px; overflow:auto; }
    .confidence-meter { display:flex; align-items:center; gap:0.5rem; margin:0.5rem 0 0.75rem; }
    .confidence-bar { flex:1; height:6px; background:#e2e8f0; border-radius:3px; overflow:hidden; }
    .confidence-fill { height:100%; width:0%; background:linear-gradient(135deg,#059669,#3b82f6); transition:width 0.4s; }
    .confidence-text { font-size:0.8rem; color:#64748b; font-weight:600; }

    /* Tables */
    .table-container { background:#fff; border:1px solid #e2e8f0; border-radius:12px; overflow:hidden; }
    .filters { padding:1rem; background:#f8fafc; border-bottom:1px solid #e2e8f0; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:0.75rem; }
    .table-wrapper { overflow:auto; max-height:65vh; }
    .table { width:100%; border-collapse:collapse; min-width:780px; }
    .table th { position:sticky; top:0; z-index:5; background:var(--secondary-gradient); color:#fff; padding:0.8rem; text-align:left; font-size:0.85rem; text-transform:uppercase; }
    .table td { padding:0.8rem; border-bottom:1px solid #e2e8f0; }

    /* Docs grid */
    .documents-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:1rem; margin-top:1rem; }
    .document-card { background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:1rem; box-shadow:0 6px 16px rgba(0,0,0,0.06); }
    .document-header { display:flex; gap:0.9rem; align-items:flex-start; }
    .document-icon { width:48px; height:48px; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; }
    .doc-pdf { background:#dc2626; }
    .doc-image { background:#059669; }
    .doc-doc { background:#3b82f6; }
    .document-name { font-weight:700; }
    .document-meta { display:flex; gap:1rem; flex-wrap:wrap; color:#64748b; font-size:0.85rem; margin:0.5rem 0 0.75rem; }
    .document-actions { display:flex; gap:0.5rem; flex-wrap:wrap; }
    .btn-sm { padding:0.45rem 0.75rem; border:none; border-radius:8px; font-size:0.8rem; font-weight:700; color:#fff; cursor:pointer; }
    .btn-primary { background:#3b82f6; }
    .btn-success { background:#059669; }

    /* Notifications + Loading */
    .notification { position:fixed; top:18px; right:18px; padding:0.9rem 1rem; color:#fff; border-radius:12px; font-weight:700; z-index:999; }
    .notification.success { background:linear-gradient(135deg,#059669,#047857); }
    .notification.error { background:linear-gradient(135deg,#dc2626,#b91c1c); }
    .notification.info { background:linear-gradient(135deg,#3b82f6,#1d4ed8); }

    .loading-overlay { position:fixed; inset:0; background:rgba(255,255,255,0.9); display:none; align-items:center; justify-content:center; z-index:1000; }
    .loading-overlay.active { display:flex; }
    .spinner { width:48px; height:48px; border:4px solid #e2e8f0; border-top-color:#3b82f6; border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }

    @media (max-width:768px){
        .main{ padding:0.75rem; }
        .table{ min-width:680px; font-size:0.9rem; }
    }
</style>
