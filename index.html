<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>EnergiaCorp - Gestione Offerte & Documenti</title>
<!-- Google Fonts e icone -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
:root {
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;

  --text-xs: 12px;
  --text-sm: 14px;
  --text-base: 16px;
  --text-lg: 20px;
  --text-xl: 24px;

  --primary: #3b82f6;
  --accent: #f59e0b;
  --error: #ef4444;
  --success: #16a34a;
  --bg-primary: #f9fafb;
  --bg-secondary: #e0f2fe;
  --border-light: #d1d5db;

  --shadow-md: rgba(0,0,0,0.1) 0 4px 12px;

  --bg-gradient: linear-gradient(135deg, #3b82f6, #0ea5e9);
  --text-white: #fff;
  --text-primary: #111827;
  --text-secondary: #6b7280;
}

/* Layout generico */
body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  background-color: var(--bg-primary);
  margin: 0;
  padding: 0;
  color: var(--text-primary);
}
h1, h2, h3 {
  margin: 0 0 var(--space-md) 0;
}
button {
  cursor: pointer;
  border: none;
  border-radius: 4px;
  padding: var(--space-sm) var(--space-md);
  background-color: var(--primary);
  color: var(--text-white);
  font-size: var(--text-sm);
  transition: background-color 0.2s;
}
button:hover {
  background-color: #2563eb;
}
input, select {
  padding: var(--space-sm);
  font-size: var(--text-sm);
  border: 1px solid var(--border-light);
  border-radius: 4px;
}
input:focus, select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

/* Header / Menu */
#header {
  background: var(--bg-gradient);
  padding: var(--space-lg);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
}
#header h1 {
  color: var(--text-white);
  font-size: var(--text-xl);
  margin: 0;
  display: flex;
  align-items: center;
}
#header h1 i {
  margin-right: var(--space-md);
}
#header .menu-buttons {
  display: flex;
  gap: var(--space-md);
}
/* Sezione principale */
section {
  padding: var(--space-xl);
}
/* Variabili per tabella */
.offers-table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: var(--shadow-md);
  margin-bottom: var(--space-xl);
}
.offers-table thead {
  background: var(--bg-gradient);
  color: var(--text-white);
}
.offers-table th, .offers-table td {
  padding: var(--space-md);
  border-bottom: 1px solid var(--border-light);
}
.offers-table th {
  font-weight: 600;
  font-size: var(--text-sm);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.offers-table tbody tr:hover td {
  background: var(--bg-secondary);
}
.offers-table .col-commodity {
  min-width: 50px;
  text-align: center;
}
/* Badge per commodity */
.badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
}
.badge-luce {
  background-color: #facc15;
  color: #ca8a04;
}
.badge-gas {
  background-color: #3b82f6;
  color: #1e40af;
}
/* Card miglior offerte */
.card-offerta {
  background: #fff;
  border-radius: 8px;
  box-shadow: var(--shadow-md);
  padding: var(--space-md);
  margin-bottom: var(--space-lg);
  display: flex;
  flex-direction: column;
}
.card-offerta .header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.card-offerta h3 {
  margin: 0;
  font-size: 1.2em;
}
.card-offerta img {
  max-width: 40px;
  height: auto;
}
.card-offerta .pricing {
  margin-top: var(--space-md);
  display: flex;
  justify-content: space-between;
}
.card-offerta .pricing .price {
  font-size: 1.4em;
  font-weight: 700;
  color: #111;
}
.card-offerta .details {
  margin-top: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}
/* Sezione Documenti */
#documenti-section {
  margin-top: var(--space-xl);
}
#documenti-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: var(--space-md);
}
.card-doc {
  background: #fff;
  padding: var(--space-md);
  border-radius: 8px;
  box-shadow: var(--shadow-md);
  display: flex;
  flex-direction: column;
}
.card-doc h4 {
  margin: 0 0 var(--space-sm) 0;
  font-size: var(--text-sm);
}
.card-doc .actions {
  margin-top: auto;
  display: flex;
  justify-content: space-between;
}
.progress-overlay {
  position: fixed;
  top: 0; left: 0; right:0; bottom:0;
  background: rgba(0,0,0,0.3);
  display:flex;
  align-items:center;
  justify-content: center;
  z-index: 9999;
  display: none;
}
.progress-overlay.show {
  display: flex;
}
.spinner {
  border: 4px solid #eee;
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  0% {transform: rotate(0deg);}
  100% {transform: rotate(360deg);}
}
</style>
</head>
<body>

<!-- HEADER NAVBAR -->
<header id="header">
  <h1><i class="fas fa-bolt"></i>EnergiaCorp</h1>
  <div class="menu-buttons">
    <button data-section="dashboard"><i class="fas fa-home"></i> Dashboard</button>
    <button data-section="offerte"><i class="fas fa-file-alt"></i> Offerte</button>
    <button data-section="gestione"><i class="fas fa-tasks"></i> Gestione</button>
    <button data-section="documenti"><i class="fas fa-folder-open"></i> Documenti</button>
    <button data-section="logout"><i class="fas fa-sign-out-alt"></i> Esci</button>
  </div>
</header>

<!-- SEZIONI -->
<section id="section-dashboard" style="display:none;">
  <h2>üìä Dashboard Offerte</h2>
  <!-- Statistiche, cards, ecc., esempio -->
  <div style="display:flex; gap:var(--space-md); flex-wrap:wrap;">
    <div class="card-offerta" style="flex:1 1 200px;">
      <div class="header">
        <h3>Migliore Offerta Luce</h3>
        <img src="https://img.icons8.com/material-outlined/40/sky--v3.png" title="Luce"/>
      </div>
      <div class="pricing"><span class="price">0.2500 ‚Ç¨/kWh</span></div>
      <div class="details">
        <div>Quota Fissa: 12,50 ‚Ç¨/mese</div>
        <div>Scadenza: 15/09/2026</div>
      </div>
    </div>
    <div class="card-offerta" style="flex:1 1 200px;">
      <div class="header">
        <h3>Migliore Offerta Gas</h3>
        <img src="https://img.icons8.com/material-outlined/40/fire.png" title="Gas"/>
      </div>
      <div class="pricing"><span class="price">0.8500 ‚Ç¨/Smc</span></div>
      <div class="details">
        <div>Quota Fissa: 10,00 ‚Ç¨/mese</div>
        <div>Scadenza: 15/10/2026</div>
      </div>
    </div>
  </div>
</section>

<section id="section-offerte" style="display:none;">
  <h2>üìã Offerte Energia</h2>
  <div id="offerte-list">
    <!-- Offerte popolate dinamicamente -->
  </div>
</section>

<section id="section-gestione" style="display:none;">
  <h2>üìù Gestione Offerte</h2>
  <table class="offers-table" id="offers-table">
    <thead>
      <tr>
        <th class="col-fornitore">Fornitore</th>
        <th class="col-nome">Nome Offerta</th>
        <th class="col-categoria">Categoria</th>
        <th class="col-tipo">Tipo Prezzo</th>
        <th class="col-commodity">Commodity</th>
        <th class="col-valore">Prezzo / Spread</th>
        <th class="col-quota">Quota Fissa</th>
        <th class="col-scadenza">Scadenza</th>
        <th class="col-azioni">Azioni</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <!-- Pulsanti per paginazione, filtri, ecc. -->
</section>

<section id="section-documenti" style="display:none;">
  <h2>üìÅ Documenti Clienti</h2>
  <button id="btn-carica-cartella"><i class="fas fa-upload"></i> Carica Cartella</button>
  <div id="cartelle-container" style="margin-top:var(--space-md);"></div>
</section>

<!-- Pop-up overlay per upload e export PDF -->
<div class="progress-overlay" id="loadingOverlay">
  <div class="spinner"></div>
</div>

<!-- Modale di modifica offerta -->
<div id="modale" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; z-index:999;">
  <div style="background:#fff; padding:var(--space-lg); border-radius:8px; max-width:600px; width:90%; max-height:90%; overflow:auto; position:relative;">
    <h2>‚úèÔ∏è Modifica Offerta</h2>
    <form id="form-modifica-offerta" style="display:flex; flex-direction:column; gap:var(--space-md);">
      <!-- Campi dinamici -->
      <input type="hidden" name="id" />
      <label>Fornitore <input type="text" name="fornitore" required /></label>
      <label>Nome Offerta <input type="text" name="nome_offerta" required /></label>
      <label>Categoria 
        <select name="categoria" required>
          <option value="Domestico">Domestico</option>
          <option value="Micro">Micro</option>
          <option value="PMI">PMI</option>
        </select>
      </label>
      <label>Tipo Prezzo
        <select name="tipo_prezzo" required>
          <option value="Fisso">Fisso</option>
          <option value="Variabile">Variabile</option>
        </select>
      </label>
      <label>Prezzo Luce
        <input type="text" name="prezzo_luce" pattern="[\d.,PUNpsv]+"/>
      </label>
      <label>Spread Luce
        <input type="text" name="spread_luce" pattern="[\d.,PUNpsv]+"/>
      </label>
      <label>Prezzo Gas
        <input type="text" name="prezzo_gas" pattern="[\d.,PUNpsv]+"/>
      </label>
      <label>Spread Gas
        <input type="text" name="spread_gas" pattern="[\d.,PUNpsv]+"/>
      </label>
      <label>Quota Fissa Luce <input type="number" step="0.01" name="quota_fissa_luce" /></label>
      <label>Quota Fissa Gas <input type="number" step="0.01" name="quota_fissa_gas" /></label>
      <label>Commissioni <input type="number" step="0.01" name="commissioni" /></label>
      <label>Scadenza <input type="date" name="scadenza" /></label>
      <label>Durata Mesi <input type="number" name="durata_mesi" min="1" max="60" /></label>
      <div style="display:flex; gap:var(--space-md); justify-content:flex-end;">
        <button type="button" id="btn-cancella">Annulla</button>
        <button type="submit">‚úÖ Salva</button>
      </div>
    </form>
  </div>
</div>

<!-- Scripts -->
<script>
const API_URL = "https://ozmqftibxuspznnqaayh.supabase.co";
const API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJ...
const SUPABASE_URL = API_URL;
const SUPABASE_ANON_KEY = API_KEY;

let currentSection = '';

/* --- Funzioni di gestione --- */
function showSection(section) {
  // nascondi tutte
  document.querySelectorAll('section').forEach(sec => sec.style.display='none');
  // mostra quella richiesta
  document.getElementById('section-'+section).style.display='block';
  currentSection = section;
  if (section==='gestione') initGestione();
  if (section==='offerte') loadOfferte();
  if(section==='documenti') loadDocumenti();
}

// Gestione menu
document.querySelectorAll('#header .menu-buttons button').forEach(btn => {
  btn.onclick = () => {
    const sect = btn.dataset.section;
    showSection(sect);
  }
});
// default
showSection('dashboard');

/* --- Gestione Offerte --- */
async function initGestione() {
  await loadOfferte();
  setupEditing();
}

// Carica offerte dal database (potresti usare fetch su API)
async function loadOfferte() {
  const tbody = document.querySelector('#offers-table tbody');
  tbody.innerHTML = '';
  // Esempio: caricamento statico
  // Per completare, integra con supabase
  // Puoi usare fetch o SDK di Supabase
  // qui un esempio fittizio
  // ...implementa fetching reale
}

/* --- Modifica offerta --- */
function setupEditing() {
  document.querySelector('#offers-table').onclick = (e) => {
    if(e.target.tagName==='BUTTON'){
      const btn = e.target;
      if(btn.dataset.action==='edit') {
        const row = btn.closest('tr');
        const id = row.dataset.id;
        apriModale(id);
      }
    }
  };
}
function apriModale(id) {
  // recupera dati offerta e popola form
  // mostra modale
}
function chiudiModale() {
  document.getElementById('modale').style.display='none';
}
document.getElementById('btn-cancella').onclick=chiudiModale;
document.getElementById('form-modifica-offerta').onsubmit = (e) => {
  e.preventDefault();
  // salva modifiche
  chiudiModale();
  loadOfferte();
};

/* --- Upload cartelle clienti --- */
document.getElementById('btn-carica-cartella').onclick=() => {
  const input = document.createElement('input');
  input.type='file';
  input.webkitdirectory=true;
  input.multiple=true;
  input.onchange=() => {
    const files = Array.from(input.files);
    // gestisci upload
  }
  input.click();
};

/* --- Export PDF OFFERTE --- */
function exportOffertePDF() {
  // usa jsPDF o altro per generare PDF con offerte
}

/* --- Gestione immagini commodity --- */
function getCommodityIcon(type) {
  if(type==='luce') return 'https://img.icons8.com/material-outlined/40/sky--v3.png';
  if(type==='gas') return 'https://img.icons8.com/material-outlined/40/fire.png';
  return '';
}

/* --- Caricamento e gestione immagini commodity in tabella --- */
// esempio:
// in loadOfferte() inserisci la colonna con <img src="...." />

/* --- Gestione documenti cliente (cartelle) --- */
const cartelle = [];
function loadDocumenti() {
  // esempio visualizzazione
}
</script>
</body>
</html>
